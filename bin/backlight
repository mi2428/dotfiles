#!/bin/bash
set -eu
cd $(dirname $0)

(( $EUID > 0 )) && sudo $0 $@ && exit 0

declare -r BACKLIGHT="/sys/class/backlight/intel_backlight/brightness"
declare -r CURRENT="$HOME/.cache/backlight/brightness"

[[ -e $CURRENT ]] && cat $CURRENT > $BACKLIGHT ||\
mkdir -p $(dirname $CURRENT) && cat $BACKLIGHT > $CURRENT

inc() {
    echo $(($(cat $CURRENT) + $1)) > $BACKLIGHT
    cat $BACKLIGHT > $CURRENT
}

dec() {
    echo $(($(cat $CURRENT) - $1)) > $BACKLIGHT ||\
    echo 0 > $BACKLIGHT
    cat $BACKLIGHT > $CURRENT
}


while getopts d:i:g OPT; do
    case $OPT in
    "g")
        cat $CURRENT > $BACKLIGHT ;;
    "d")
        dec $OPTARG 2> /dev/null ;;
    "i")
        inc $OPTARG 2> /dev/null ;;
    esac
done
